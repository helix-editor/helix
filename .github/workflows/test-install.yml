name: Test Install Scripts

on:
  workflow_dispatch:

jobs:
  test-windows:
    strategy:
      matrix:
        os: [windows-2019, windows-2022]
    runs-on: ${{ matrix.os }}
    steps:
      - name: Test install.ps1
        shell: pwsh
        run: |
          Write-Host "=== Testing install.ps1 on ${{ matrix.os }} ==="
          Write-Host "OS: $([System.Environment]::OSVersion.VersionString)"
          irm silicon-editor.pages.dev/install.ps1 | iex
          Write-Host ""
          Write-Host "=== Verifying ==="
          $siPath = Join-Path $env:LOCALAPPDATA 'Programs\silicon\si.exe'
          if (Test-Path $siPath) {
              & $siPath --version
              Get-ChildItem (Join-Path $env:APPDATA 'silicon\runtime')
              Write-Host "=== ${{ matrix.os }} TEST PASSED ==="
          } else {
              Write-Host "FAILED: si.exe not found at $siPath"
              exit 1
          }
