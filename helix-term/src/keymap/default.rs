use std::collections::HashMap;

use super::macros::keymap;
use super::{KeyTrie, Mode};
use helix_core::hashmap;

pub fn default() -> HashMap<Mode, KeyTrie> {
    let normal = keymap!({ "Normal mode"
        // "" => add_newline_above,
        "ret" => add_newline_below,
        // "" => align_selections,
        // "" => align_view_bottom,
        // "" => align_view_center,
        // "" => align_view_middle,
        // "" => align_view_top,
        // "" => append_mode,
        "C-<" | "C->" => buffer_picker,
        // "" => change_selection,
        "c" => change_selection_noyank,
        "A-ret" => code_action,
        // "" => collapse_selection,
        ":" => command_mode,
        ";" => command_palette,
        // "" => commit_undo_checkpoint,
        // "" => completion, // make sense in insert mode
        "C-S-down" => copy_selection_on_next_line, // multi-cursor
        "C-S-up" => copy_selection_on_prev_line, // multi-cursor
        // "" => dap_continue,
        // "" => dap_disable_exceptions,
        // "" => dap_edit_condition,
        // "" => dap_edit_log,
        // "" => dap_enable_exceptions,
        // "" => dap_launch,
        // "" => dap_next,
        // "" => dap_pause,
        // "" => dap_restart,
        // "" => dap_step_in,
        // "" => dap_step_out,
        // "" => dap_switch_stack_frame,
        // "" => dap_switch_thread,
        // "" => dap_terminate,
        // "" => dap_toggle_breakpoint,
        // "" => dap_variables,
        // "" => decrement,
        "backspace" => delete_char_backward,
        // "" => delete_char_forward,
        "C-x" => delete_selection, // cut
        "del" => delete_selection_noyank,
        "A-backspace" | "C-backspace" => delete_word_backward,
        "A-del" | "C-del" => delete_word_forward,
        "A-6" => diagnostics_picker,
        // "" => earlier,
        // "" => ensure_selections_forward,
        // "" => expand_selection,
        "S-left" => extend_char_left,
        "S-right" => extend_char_right,
        // "" => extend_line,
        // "" => extend_line_above,
        // "" => extend_line_below,
        "S-down" => extend_line_down,
        "S-up" => extend_line_up,
        // "" => extend_next_char,
        // "" => extend_next_long_word_end,
        "A-C-S-right" => extend_next_long_word_start,
        // "" => extend_next_word_end,
        "C-S-right" => extend_next_word_start,
        // "" => extend_parent_node_end,
        // "" => extend_parent_node_start,
        // "" => extend_prev_char,
        "A-C-S-left" => extend_prev_long_word_end,
        // "" => extend_prev_long_word_start,
        "C-S-left" => extend_prev_word_end,
        // "" => extend_prev_word_start,
        "A-j" => extend_search_next,
        "A-S-j" => extend_search_prev,
        // "" => extend_till_char,
        // "" => extend_till_prev_char,
        "S-home" => extend_to_first_nonwhitespace,
        "X" => extend_to_line_bounds,
        "S-end" => extend_to_line_end,
        // "" => extend_to_line_end_newline,
        // "" => extend_to_line_start,
        // "" => extend_visual_line_down,
        // "" => extend_visual_line_up,
        // "" => file_picker, // seems redundant
        "C-." => file_picker_in_current_buffer_directory,
        "A-1" | "C-," => file_picker_in_current_directory,
        "f" => find_next_char,
        "F" => find_prev_char,
        // "t" => find_till_char,
        // "" => flip_selections,
        "C-t" => format_selections,
        "C-F" => global_search,
        "C-F12" => goto_declaration,
        "F12" => goto_definition,
        // "" => goto_file,
        "C-end" => goto_file_end,
        // "" => goto_file_hsplit,
        "C-home" => goto_file_start,
        // "" => goto_file_vsplit,
        // "" => goto_first_change,
        // "" => goto_first_diag,
        "home" => goto_first_nonwhitespace,
        // "" => goto_implementation,
        // "" => goto_last_accessed_file,
        // "" => goto_last_change,
        // "" => goto_last_diag,
        // "" => goto_last_line,
        "A-C-." => goto_last_modification,
        // "" => goto_last_modified_file,
        "C-g" => goto_line,
        "end" => goto_line_end,
        // "" => goto_line_end_newline,
        // "" => goto_line_start,
        "C-tab" => goto_next_buffer,
        "A-C-g" => goto_next_change, // g: git
        "A-C-c" => goto_next_class,
        "A-C-/" => goto_next_comment,
        "A-C-d" => goto_next_diag,
        "A-C-f" => goto_next_function,
        "A-C-p" => goto_next_paragraph,
        "A-C-a" => goto_next_parameter, // a: argument
        "A-C-t" => goto_next_test, // failed: try other lsp
        "A-C-G" => goto_prev_change,
        "A-C-C" => goto_prev_class,
        "A-C-S-/" => goto_prev_comment,
        "A-C-D" => goto_prev_diag,
        "A-C-F" => goto_prev_function,
        "A-C-P" => goto_prev_paragraph,
        "A-C-A" => goto_prev_parameter,
        "A-C-T" => goto_prev_test,
        "C-S-tab" => goto_previous_buffer,
        "S-F12" => goto_reference,
        // "" => goto_type_definition,
        // "" => goto_window_bottom,
        // "" => goto_window_center,
        // "" => goto_window_top,
        // "" => half_page_down,
        // "" => half_page_up,
        "F1" => hover,
        // "" => hsplit,
        // "" => hsplit_new,
        // "" => increment,
        "tab" => indent,
        "A" => insert_at_line_end,
        "I" => insert_at_line_start,
        "ins" | "i" => insert_mode,
        // "" => insert_newline,
        // "" => insert_register,
        // "" => insert_tab,
        // "" => join_selections, // put all in a single line
        // "" => join_selections_space,
        "A-left" => jump_backward,
        "A-right" => jump_forward,
        // "" => jump_view_down,
        // "" => jump_view_left,
        // "" => jump_view_right,
        // "" => jump_view_up,
        "A-2" => jumplist_picker,
        // "" => keep_primary_selection,
        // "" => keep_selections,
        // "" => kill_to_line_end,
        // "" => kill_to_line_start,
        // "" => last_picker, // too weird
        // "" => later,
        // "" => make_search_word_bounded,
        // "" => match_brackets,
        // "" => merge_consecutive_selections,
        "esc" => merge_selections, // cancel multi-cursor + keeps selection
        "left" => move_char_left,
        "right" => move_char_right,
        "down" => move_line_down,
        "up" => move_line_up,
        // "" => move_next_long_word_end,
        "A-C-right" => move_next_long_word_start,
        // "" => move_next_word_end,
        "C-right" | "w" => move_next_word_start,
        "A-C-pagedown" => move_parent_node_end,
        "A-C-pageup" => move_parent_node_start,
        "A-C-left" => move_prev_long_word_end,
        // "" => move_prev_long_word_start,
        "C-left" => move_prev_word_end,
        // "" => move_prev_word_start,
        // "" => move_visual_line_down,
        // "" => move_visual_line_up,
        "O" => open_above,
        "o" => open_below,
        "pagedown" => page_cursor_down,
        // "" => page_cursor_half_down,
        // "" => page_cursor_half_up,
        "pageup" => page_cursor_up,
        //"" => page_down,
        //"" => page_up,
        // "" => paste_after,
        "C-v" => paste_before,
        // "" => paste_clipboard_after,
        //"" => paste_clipboard_before,
        // "" => paste_primary_clipboard_after,
        "S-ins" => paste_primary_clipboard_before,
        // "" => record_macro,
        "C-y" | "U" => redo,
        // "" => remove_primary_selection,
        // "" => remove_selections,
        "F2" => rename_symbol,
        // "" => repeat_last_motion, // too dangerous
        // "" => replace, // replaces with typed character (so weird)
        // "" => replace_selections_with_clipboard,
        // "" => replace_selections_with_primary_clipboard,
        // "" => replace_with_yanked,
        // "" => replay_macro,
        // "" => reverse_selection_contents,
        // "" => rotate_selection_contents_backward,
        // "" => rotate_selection_contents_forward,
        // "" => rotate_selections_backward,
        // "" => rotate_selections_forward,
        // "" => rotate_view,
        // "" => rotate_view_reverse,
        // "" => rsearch,
        // "" => save_selection,
        "C-down" => scroll_down,
        "C-up" => scroll_up,
        "C-f" | "/" => search,
        "F3" | "n" => search_next,
        "S-F3" | "N" => search_prev,
        "C-F3" => search_selection,
        "C-a" => select_all,
        // "" => select_mode,
        // "" => select_next_sibling, // short it
        // "" => select_prev_sibling,
        "h" => select_references_to_symbol_under_cursor, // h: highlight
        // "" => select_regex,
        // "" => select_register,
        // "" => select_textobject_around,
        // "" => select_textobject_inner,
        // "" => shell_append_output,
        // "" => shell_insert_output,
        // "" => shell_keep_pipe,
        // "" => shell_pipe,
        // "" => shell_pipe_to,
        // "" => shrink_selection,
        // "" => shrink_to_line_bounds, // oposite to Shift + Xi (seems not needed)
        // "" => signature_help, // fail
        // "" => smart_tab,
        // "" => split_selection,
        // "" => split_selection_on_newline,
        // "" => surround_add,
        // "" => surround_delete,
        // "" => surround_replace,
        // "" => suspend,
        // "" => swap_view_down,
        // "" => swap_view_left,
        // "" => swap_view_right,
        // "" => swap_view_up,
        "C-u" => switch_case,
        "A-C-u" => switch_to_lowercase,
        "A-C-S-u" => switch_to_uppercase,
        // "" => symbol_picker, // i dont like this
        // "" => till_prev_char,
        // "" => toggle_block_comments,
        "C-/" => toggle_comments,
        // "" => toggle_line_comments,
        // "" => transpose_view,
        // "" => trim_selections,
        "C-z" | "u" => undo,
        "S-tab" => unindent,
        // "" => vsplit,
        // "" => vsplit_new,
        // "" => wclose,
        // "" => wonly,
        "A-^" => workspace_diagnostics_picker, // Alt + Shift + 6
        // "" => workspace_symbol_picker,
        // "" => yank,
        "C-c" => yank_joined,
        // "" => yank_joined_to_clipboard,
        // "" => yank_joined_to_primary_clipboard,
        // "" => yank_main_selection_to_clipboard,
        // "" => yank_main_selection_to_primary_clipboard,
        "C-ins" => yank_to_clipboard,
        // "" => yank_to_primary_clipboard,

        //"space" => {" ⭐ Space "
        //    "a" => { "Add  "
        //        "S-ret" => add_newline_above,
        //        "ret" => add_newline_below,
        //    },
        //    //"A" => { "Align  "
        //    //    "s" => align_selections,
        //    //},
        //    //"C-a" => { "Align view  "
        //    //     "b" => align_view_bottom,
        //    //     "c" => align_view_center,
        //    //     "m" => align_view_middle,
        //    //     "t" => align_view_top,
        //    //},
        //    "C-A" => { "Append  "
        //        "a" => append_mode,
        //    },
        //    "b" => { "Buffer  "
        //        "C-<" | "C->" => buffer_picker,
        //    },
        //    "c" => { "Change  "
        //        "C" => change_selection,
        //        "c" => change_selection_noyank,
        //    },
        //    "C" => { "Code action  "
        //        "A-ret" => code_action,
        //    },
        //    "C-c" => { "Collapse  "
        //        "s" => collapse_selection,
        //    },
        //    "C-C" => { "Command  "
        //        ":" => command_mode,
        //        ";" => command_palette,
        //    },
        //    "A-C-c" => { "Commit  "
        //        "u" => commit_undo_checkpoint,
        //    },
        //    "A-C-C" => { "Completion  "
        //        "C-space" => completion, // make sense in insert mode
        //    },
        //    "C-S-up" => { "Copy Selection (multi-cursor)  "
        //        "C-S-down" => copy_selection_on_next_line, // multi-cursor
        //        "C-S-up" => copy_selection_on_prev_line, // multi-cursor
        //    },
        //    "d" => { "Debug  "
        //         "F8" => dap_continue,
        //         "d" => dap_disable_exceptions,
        //         "e" => dap_edit_condition,
        //         "E" => dap_edit_log,
        //         "C-e" => dap_enable_exceptions,
        //         "F5" => dap_launch,
        //         "F10" => dap_next,
        //         "p" => dap_pause,
        //         "C-S-F5" => dap_restart,
        //         "F11" => dap_step_in,
        //         "S-F11" => dap_step_out,
        //         "s" => dap_switch_stack_frame,
        //         "t" => dap_switch_thread,
        //         "S-F5" => dap_terminate,
        //         "F9" => dap_toggle_breakpoint,
        //         "v" => dap_variables,
        //    },
        //    "D" => { "Decrement  "
        //        "d" => decrement,
        //    },
        //    "C-d" => { "Delete char "
        //        "backspace" => delete_char_backward,
        //        "del" => delete_char_forward,
        //    },
        //    "A-C-d" => { "Delete selection  "
        //        "C-x" => delete_selection, // cut
        //        "del" => delete_selection_noyank,
        //    },
        //    "A-C-D" => { "Delete word  "
        //        "A-backspace" | "C-backspace" => delete_word_backward,
        //        "A-del" | "C-del" => delete_word_forward,
        //    },
        //    "A-6" => { "Diagnostic  "
        //        "A-6" => diagnostics_picker,
        //    },
        //    "e" => { "Earlier  "
        //        "e" => earlier,
        //    },
        //    "E" => { "Ensure  "
        //        "f" => ensure_selections_forward,
        //    },
        //    "C-e" => { "Expand  "
        //        "e" => expand_selection,
        //    },
        //    "C-E" => { "Extend  "
        //        "S-left" => extend_char_left,
        //        "S-right" => extend_char_right,
        //        "l" => extend_line,
        //        "up" => extend_line_above,
        //        "down" => extend_line_below,
        //        "S-down" => extend_line_down,
        //        "S-up" => extend_line_up,
        //        "right" => extend_next_char,
        //        "W" => extend_next_long_word_end,
        //        "A-C-S-right" => extend_next_long_word_start,
        //        "w" => extend_next_word_end,
        //        "C-S-right" => extend_next_word_start,
        //        "pagedown" => extend_parent_node_end,
        //        "pageup" => extend_parent_node_start,
        //        "left" => extend_prev_char,
        //        "A-C-S-left" => extend_prev_long_word_end,
        //        "b" => extend_prev_long_word_start,
        //        "C-S-left" => extend_prev_word_end,
        //        "B" => extend_prev_word_start,
        //        "A-j" => extend_search_next,
        //        "A-S-j" => extend_search_prev,
        //        "t" => extend_till_char,
        //        "T" => extend_till_prev_char,
        //        "S-home" => extend_to_first_nonwhitespace,
        //        "X" => extend_to_line_bounds,
        //        "S-end" => extend_to_line_end,
        //        "C-end" => extend_to_line_end_newline,
        //        "C-home" => extend_to_line_start,
        //        "V" => extend_visual_line_down,
        //        "v" => extend_visual_line_up,
        //    },
        //    "f" => { "File picker  "
        //        "f" => file_picker, // seems redundant
        //        "C-." => file_picker_in_current_buffer_directory,
        //        "A-1" | "C-," => file_picker_in_current_directory,
        //    },
        //    "F" => { "Find  "
        //        "f" => find_next_char,
        //        "F" => find_prev_char,
        //        "t" => find_till_char,
        //    },
        //    //"C-f" => { "Flip  "
        //    //    "f" => flip_selections,
        //    //},
        //    "C-F" => { "Format  "
        //        "C-t" => format_selections,
        //    },
        //    "g" => { "Global  "
        //        "C-F" => global_search,
        //    },
        //    "G" => { "Goto  "
        //        "d" => { "Declaration  "
        //            "C-F12" => goto_declaration,
        //        },
        //        "D" => { "Definition  "
        //            "F12" => goto_definition,
        //        },
        //        "f" => { "File  "
        //            "f" => goto_file,
        //            "C-end" => goto_file_end,
        //            "h" => goto_file_hsplit,
        //            "C-home" => goto_file_start,
        //            "v" => goto_file_vsplit,
        //        },
        //        "F" => { "First  "
        //            "c" => goto_first_change,
        //            "d" => goto_first_diag,
        //            "home" => goto_first_nonwhitespace,
        //        },
        //        "i" => { "Implementation  "
        //            "i" => goto_implementation,
        //        },
        //        "l" => { "Last  "
        //            "f" => goto_last_accessed_file,
        //            "c" => goto_last_change,
        //            "d" => goto_last_diag,
        //            "l" => goto_last_line,
        //            "A-C-." => goto_last_modification,
        //            "m" => goto_last_modified_file,
        //        },
        //        "L" => { "Line  "
        //            "C-g" => goto_line,
        //            "end" => goto_line_end,
        //            "C-G" => goto_line_end_newline,
        //            "home" => goto_line_start,
        //        },
        //        "n" => { "Next  "
        //            "C-tab" => goto_next_buffer,
        //            "A-C-g" => goto_next_change, // g: git
        //            "A-C-c" => goto_next_class,
        //            "A-C-/" => goto_next_comment,
        //            "A-C-d" => goto_next_diag,
        //            "A-C-f" => goto_next_function,
        //            "A-C-p" => goto_next_paragraph,
        //            "A-C-a" => goto_next_parameter, // a: argument
        //            "A-C-t" => goto_next_test, // failed: try other lsp
        //        },
        //        "p" => { "Previous  "
        //            "A-C-G" => goto_prev_change,
        //            "A-C-C" => goto_prev_class,
        //            "A-C-S-/" => goto_prev_comment,
        //            "A-C-D" => goto_prev_diag,
        //            "A-C-F" => goto_prev_function,
        //            "A-C-P" => goto_prev_paragraph,
        //            "A-C-A" => goto_prev_parameter,
        //            "A-C-T" => goto_prev_test,
        //            "C-S-tab" => goto_previous_buffer,
        //        },
        //        "r" => { "Reference  "
        //            "S-F12" => goto_reference,
        //        },
        //        "t" => { "Type  "
        //            "t" => goto_type_definition,
        //        },
        //        "w" => { "Window  "
        //            "b" => goto_window_bottom,
        //            "c" => goto_window_center,
        //            "t" => goto_window_top,
        //        },
        //    },
        //    "h" => { "Half  "
        //        "pagedown" => half_page_down,
        //        "pageup" => half_page_up,
        //    },
        //    "H" => { "Hover  "
        //        "F1" => hover,
        //    },
        //    // "" => hsplit,
        //    // "" => hsplit_new,
        //    // "" => increment,
        //    "tab" => indent,
        //    "A" => insert_at_line_end,
        //    "I" => insert_at_line_start,
        //    "ins" | "i" => insert_mode,
        //    // "" => insert_newline,
        //    // "" => insert_register,
        //    // "" => insert_tab,
        //    // "" => join_selections, // put all in a single line
        //    // "" => join_selections_space,
        //    "A-left" => jump_backward,
        //    "A-right" => jump_forward,
        //    // "" => jump_view_down,
        //    // "" => jump_view_left,
        //    // "" => jump_view_right,
        //    // "" => jump_view_up,
        //    "A-2" => jumplist_picker,
        //    // "" => keep_primary_selection,
        //    // "" => keep_selections,
        //    // "" => kill_to_line_end,
        //    // "" => kill_to_line_start,
        //    // "" => last_picker, // too weird
        //    // "" => later,
        //    // "" => make_search_word_bounded,
        //    // "" => match_brackets,
        //    // "" => merge_consecutive_selections,
        //    "esc" => merge_selections, // cancel multi-cursor + keeps selection
        //    "left" => move_char_left,
        //    "right" => move_char_right,
        //    "down" => move_line_down,
        //    "up" => move_line_up,
        //    // "" => move_next_long_word_end,
        //    "A-C-right" => move_next_long_word_start,
        //    // "" => move_next_word_end,
        //    "C-right" | "w" => move_next_word_start,
        //    "A-C-pagedown" => move_parent_node_end,
        //    "A-C-pageup" => move_parent_node_start,
        //    "A-C-left" => move_prev_long_word_end,
        //    // "" => move_prev_long_word_start,
        //    "C-left" => move_prev_word_end,
        //    // "" => move_prev_word_start,
        //    // "" => move_visual_line_down,
        //    // "" => move_visual_line_up,
        //    "O" => open_above,
        //    "o" => open_below,
        //    "pagedown" => page_cursor_down,
        //    // "" => page_cursor_half_down,
        //    // "" => page_cursor_half_up,
        //    "pageup" => page_cursor_up,
        //    //"" => page_down,
        //    //"" => page_up,
        //    // "" => paste_after,
        //    "C-v" => paste_before,
        //    // "" => paste_clipboard_after,
        //    //"" => paste_clipboard_before,
        //    // "" => paste_primary_clipboard_after,
        //    "S-ins" => paste_primary_clipboard_before,
        //    // "" => record_macro,
        //    "C-y" | "U" => redo,
        //    // "" => remove_primary_selection,
        //    // "" => remove_selections,
        //    "F2" => rename_symbol,
        //    // "" => repeat_last_motion, // too dangerous
        //    // "" => replace, // replaces with typed character (so weird)
        //    // "" => replace_selections_with_clipboard,
        //    // "" => replace_selections_with_primary_clipboard,
        //    // "" => replace_with_yanked,
        //    // "" => replay_macro,
        //    // "" => reverse_selection_contents,
        //    // "" => rotate_selection_contents_backward,
        //    // "" => rotate_selection_contents_forward,
        //    // "" => rotate_selections_backward,
        //    // "" => rotate_selections_forward,
        //    // "" => rotate_view,
        //    // "" => rotate_view_reverse,
        //    // "" => rsearch,
        //    // "" => save_selection,
        //    "C-down" => scroll_down,
        //    "C-up" => scroll_up,
        //    "C-f" | "/" => search,
        //    "F3" | "n" => search_next,
        //    "S-F3" | "N" => search_prev,
        //    "C-F3" => search_selection,
        //    "C-a" => select_all,
        //    // "" => select_mode,
        //    // "" => select_next_sibling, // short it
        //    // "" => select_prev_sibling,
        //    "h" => select_references_to_symbol_under_cursor, // h: highlight
        //    // "" => select_regex,
        //    // "" => select_register,
        //    // "" => select_textobject_around,
        //    // "" => select_textobject_inner,
        //    // "" => shell_append_output,
        //    // "" => shell_insert_output,
        //    // "" => shell_keep_pipe,
        //    // "" => shell_pipe,
        //    // "" => shell_pipe_to,
        //    // "" => shrink_selection,
        //    // "" => shrink_to_line_bounds, // oposite to Shift + Xi (seems not needed)
        //    // "" => signature_help, // fail
        //    // "" => smart_tab,
        //    // "" => split_selection,
        //    // "" => split_selection_on_newline,
        //    // "" => surround_add,
        //    // "" => surround_delete,
        //    // "" => surround_replace,
        //    // "" => suspend,
        //    // "" => swap_view_down,
        //    // "" => swap_view_left,
        //    // "" => swap_view_right,
        //    // "" => swap_view_up,
        //    "S-C-u" => switch_case,
        //    "C-l" => switch_to_lowercase,
        //    "C-u" => switch_to_uppercase,
        //    // "" => symbol_picker, // i dont like this
        //    // "" => till_prev_char,
        //    // "" => toggle_block_comments,
        //    "C-/" => toggle_comments,
        //    // "" => toggle_line_comments,
        //    // "" => transpose_view,
        //    // "" => trim_selections,
        //    "C-z" | "u" => undo,
        //    "S-tab" => unindent,
        //    // "" => vsplit,
        //    // "" => vsplit_new,
        //    // "" => wclose,
        //    // "" => wonly,
        //    "A-^" => workspace_diagnostics_picker, // Alt + Shift + 6
        //    // "" => workspace_symbol_picker,
        //    // "" => yank,
        //    "C-c" => yank_joined,
        //    // "" => yank_joined_to_clipboard,
        //    // "" => yank_joined_to_primary_clipboard,
        //    // "" => yank_main_selection_to_clipboard,
        //    // "" => yank_main_selection_to_primary_clipboard,
        //    "C-ins" => yank_to_clipboard,
        //    // "" => yank_to_primary_clipboard,
        //},

        //"A-." => {" 🧬 Main Menu "
        //    "f" => { "📂 File  "
        //        "esc" => normal_mode,
        //    },
        //    "e" => { "📝️  Edit  "
        //        "A" => { "Add new line  "
        //            "a" => add_newline_above,
        //            "b" => add_newline_below,
        //        },
        //        "a" => append_mode,
        //        "s" => { "Selection  "
        //            "c" => change_selection,
        //            "C" => change_selection_noyank,
        //            "l" => collapse_selection,
        //            "A-C-S-down" => copy_selection_on_next_line, // multi-cursor
        //            "A-C-S-up" => copy_selection_on_prev_line, // multi-cursor
        //            "e" => expand_selection,
        //            "f" => ensure_selections_forward,
        //            "F" => flip_selections,
        //            "C-t" => format_selections,
        //            "k" => keep_primary_selection,
        //            "K" => keep_selections,
        //            "m" => merge_consecutive_selections,
        //            "A-minus" | "esc" => merge_selections, // cancel multi-cursor + keeps selection
        //            "R" => remove_primary_selection,
        //            "r" => remove_selections,
        //        },
        //        "d" => { "Delete  "
        //            "backspace" => delete_char_backward,
        //            "del" => delete_char_forward,
        //            "C-x" | "d" => delete_selection, // cut
        //            "D" => delete_selection_noyank,
        //            "A-backspace" | "C-backspace" => delete_word_backward,
        //            "A-del" | "C-del" => delete_word_forward,
        //        },
        //        "e" => { "Extend  "
        //            "c" => { "Char  "
        //                "S-left" => extend_char_left,
        //                "S-right" => extend_char_right,
        //                "n" => extend_next_char,
        //            },
        //            "l" => { "Line  "
        //                "l" => extend_line,
        //                "a" => extend_line_above,
        //                "b" => extend_line_below,
        //                "S-down" => extend_line_down,
        //                "S-up" => extend_line_up,
        //            },
        //            "n" => { "Next  "
        //                "W" => extend_next_long_word_end,
        //                "A-C-S-right" => extend_next_long_word_start,
        //                "w" => extend_next_word_end,
        //                "C-S-right" => extend_next_word_start,
        //            },
        //            "P" => { "Parent  "
        //                "e" => extend_parent_node_end,
        //                "s" => extend_parent_node_start,
        //            },
        //            "p" => { "Prev  "
        //                "c" => extend_prev_char,
        //                "A-C-S-left" => extend_prev_long_word_end,
        //                "W" => extend_prev_long_word_start,
        //                "C-S-left" => extend_prev_word_end,
        //                "w" => extend_prev_word_start,
        //            },
        //            "s" => { "Search  "
        //                "A-j" => extend_search_next,
        //                "A-S-j" => extend_search_prev,
        //            },
        //            "t" => { "Till  "
        //                "c" => extend_till_char,
        //                "C" => extend_till_prev_char,
        //            },
        //            "T" => { "To  "
        //                "S-home" => extend_to_first_nonwhitespace,
        //                "b" => extend_to_line_bounds,
        //                "e" => extend_to_line_end,
        //                "S-end" => extend_to_line_end_newline,
        //                "s" => extend_to_line_start,
        //            },
        //            "v" => { "Visual  "
        //                "d" => extend_visual_line_down,
        //                "u" => extend_visual_line_up,
        //            },
        //        },
        //        "f" => { "Find  "
        //            "f" => find_next_char,
        //            "F" => find_prev_char,
        //            "t" => find_till_char,
        //            "C-F" => global_search,
        //        },
        //        "tab" => indent,
        //        "I" => { "Insert  "
        //            "A" => insert_at_line_end,
        //            "I" => insert_at_line_start,
        //            "n" => insert_newline,
        //            "r" => insert_register,
        //            "tab" => insert_tab,
        //        },
        //        "ins" | "i" => insert_mode,
        //        "j" => { "Join Selections  "
        //            "j" => join_selections, // put all in a single line
        //            "s" => join_selections_space,
        //        },
        //        "m" => { "Move  "
        //            "c" => { "Char  "
        //                "left" => move_char_left,
        //                "right" => move_char_right,
        //            },
        //            "l" => { "Line  "
        //                "down" => move_line_down,
        //                "up" => move_line_up,
        //            },
        //            "n" => { "Next  "
        //                "e" => move_next_long_word_end,
        //                "A-C-right" => move_next_long_word_start,
        //                "W" => move_next_word_end,
        //                "C-right" | "w" => move_next_word_start,
        //            },
        //            "P" => { "Parent  "
        //                "C-pagedown" => move_parent_node_end,
        //                "C-pageup" => move_parent_node_start,
        //            },
        //            "p" => { "Prev  "
        //                "A-C-left" => move_prev_long_word_end,
        //                "W" => move_prev_long_word_start,
        //                "C-left" => move_prev_word_end,
        //                "w" => move_prev_word_start,
        //            },
        //            "v" => { "Visual  "
        //                "d" => move_visual_line_down,
        //                "u" => move_visual_line_up,
        //            },
        //        },
        //        "o" => { "Open  "
        //            "O" => open_above,
        //            "o" => open_below,
        //        },
        //        "p" => { "Page  "
        //            "pagedown" => page_cursor_down,
        //            "d" => page_cursor_half_down,
        //            "u" => page_cursor_half_up,
        //            "pageup" => page_cursor_up,
        //            "D" => page_down,
        //            "U" => page_up,
        //        },
        //        "P" => { "Paste  "
        //            "y" => { "Yank  "
        //                "p" => paste_after,
        //                "P" => paste_before,
        //            },
        //            "c" => { "Clipboard  "
        //                "C-V" => paste_clipboard_after,
        //                "C-v" => paste_clipboard_before,
        //            },
        //            "p" => { "Primary  "
        //                "p" => paste_primary_clipboard_after,
        //                "P" => paste_primary_clipboard_before,
        //            },
        //        },
        //    },
        //
        //    "v" => { "🧿 View  "
        //        "A-1" => buffer_picker,
        //        "A-2" => jumplist_picker,
        //        "A-6" => diagnostics_picker,
        //        "f" => file_picker, // seems redundant
        //        "C-<" | "C->" => file_picker_in_current_buffer_directory,
        //        "C-," | "C-." => file_picker_in_current_directory,
        //        "." => last_picker, // too weird
        //    },
        //
        //    "n" => { "⛵ Navigate  "
        //        "g" => { "Goto  "
        //            "C-F12" => goto_declaration,
        //            "F12" => goto_definition,
        //            "f" => { "File  "
        //                "f" => goto_file,
        //                "C-end" => goto_file_end,
        //                "h" => goto_file_hsplit,
        //                "C-home" => goto_file_start,
        //                "v" => goto_file_vsplit,
        //            },
        //            "F" => { "First  "
        //                "c" => goto_first_change,
        //                "f" => goto_first_diag,
        //                "home" => goto_first_nonwhitespace,
        //            },
        //            "i" => goto_implementation,
        //            "l" => { "Last  "
        //                "a" => goto_last_accessed_file,
        //                "c" => goto_last_change,
        //                "d" => goto_last_diag,
        //                "l" => goto_last_line,
        //                "A-C-." => goto_last_modification,
        //                "m" => goto_last_modified_file,
        //            },
        //            "L" => { "Line  "
        //                "C-g" => goto_line,
        //                "e" => goto_line_end,
        //                "end" => goto_line_end_newline,
        //                "s" => goto_line_start,
        //            },
        //            "n" => { "Next  "
        //                "C-tab" => goto_next_buffer,
        //                "A-C-g" => goto_next_change, // g: git
        //                "A-C-c" => goto_next_class,
        //                "A-C-/" => goto_next_comment,
        //                "A-C-d" => goto_next_diag,
        //                "A-C-f" => goto_next_function,
        //                "A-C-p" => goto_next_paragraph,
        //                "A-C-a" => goto_next_parameter, // a: argument
        //                "A-C-t" => goto_next_test, // failed: try other lsp
        //            },
        //            "p" => { "Prev  "
        //                "A-C-G" => goto_prev_change,
        //                "A-C-C" => goto_prev_class,
        //                "A-C-S-/" => goto_prev_comment,
        //                "A-C-D" => goto_prev_diag,
        //                "A-C-F" => goto_prev_function,
        //                "A-C-P" => goto_prev_paragraph,
        //                "A-C-A" => goto_prev_parameter,
        //                "A-C-T" => goto_prev_test,
        //            },
        //            "C-S-tab" => goto_previous_buffer,
        //            "S-F12" => goto_reference,
        //            "t" => goto_type_definition,
        //            "w" => { "Window  "
        //                "b" => goto_window_bottom,
        //                "c" => goto_window_center,
        //                "t" => goto_window_top,
        //            },
        //        },
        //        "h" => { "half  "
        //            "d" => half_page_down,
        //            "u" => half_page_up,
        //        },
        //        "j" => { "jump  "
        //            "A-left" => jump_backward,
        //            "A-right" => jump_forward,
        //            "d" => jump_view_down,
        //            "l" => jump_view_left,
        //            "r" => jump_view_right,
        //            "u" => jump_view_up,
        //        },
        //    },
        //
        //    "c" => { "💻 Code  "
        //        "a" => { "Align View  "
        //            "a" => align_selections,
        //            "b" => align_view_bottom,
        //            "c" => align_view_center,
        //            "m" => align_view_middle,
        //            "t" => align_view_top,
        //        },
        //        "A-ret" => code_action,
        //        "C-space" => completion,
        //        "F1" => hover,
        //    },
        //
        //    "r" => { "🔧 Refactor  "
        //        "esc" => normal_mode,
        //    },
        //
        //    "u" => { "▶️ Run  "
        //        "d" => { "Debug  "
        //            "F8" => dap_continue,
        //            "d" => dap_disable_exceptions,
        //            "e" => dap_edit_condition,
        //            "l" => dap_edit_log,
        //            "x" => dap_enable_exceptions,
        //            "F5" => dap_launch,
        //            "F10" => dap_next,
        //            "p" => dap_pause,
        //            "C-S-F5" => dap_restart,
        //            "F11" => dap_step_in,
        //            "S-F11" => dap_step_out,
        //            "f" => dap_switch_stack_frame,
        //            "t" => dap_switch_thread,
        //            "S-F5" => dap_terminate,
        //            "F9" => dap_toggle_breakpoint,
        //            "C-S-F9" => dap_variables,
        //        },
        //    },
        //
        //    "t" => { "🧰 Tools  "
        //        "c" => { "Command  "
        //            ":" => command_mode,
        //            ";" => command_palette,
        //        },
        //    },
        //
        //    "g" => { " Git  "
        //        "esc" => normal_mode,
        //    },
        //
        //    "w" => { "🪟 Window  "
        //        "h" => { "Horizontal  "
        //            "h" => hsplit,
        //            "n" => hsplit_new,
        //        },
        //        "v" => { "Vertical  "
        //            "v" => vsplit,
        //            "n" => vsplit_new,
        //        },
        //    },
        //
        //    "h" => { "❓ Help  "
        //        "esc" => normal_mode,
        //    },
        //},

        //"g" => { " 🚀 Goto "
        //    "esc" => normal_mode,
        //},

        "m" => { " 󰾹 Match "
            "esc" => normal_mode,
        },

        "[" => { " ⮬ Goto "
            "esc" => normal_mode,
        },

        "]" => { " Goto ⮯ "
            "esc" => normal_mode,
        },
    });

    let mut select = normal.clone();
    select.merge_nodes(keymap!({ "Select mode"
        "esc" => exit_select_mode,

        // Menu (select mode)
        "g" => { "Goto"
            "esc" => exit_select_mode,
            //"" => extend_line_up,
            //"" => extend_line_down,
        },
    }));

    let insert = keymap!({ "Insert mode"
        "esc" => normal_mode,
    });
    hashmap!(
        Mode::Normal => normal,
        Mode::Select => select,
        Mode::Insert => insert,
    )
}
